<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>–ü—É—Ç—å –ü–∏—Ç–æ–Ω–∏—Å—Ç–∞</title>
    <link href="style.css" rel="stylesheet" />
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
  </head>
  <body>
    <div id="app">
      <h1>–ó–∞–≥—Ä—É–∑–∫–∞...</h1>
    </div>

    <script>
      // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
      let currentSection = null;
      let currentLesson = null;
      const app = document.getElementById("app");

      // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ sections.json
      async function loadData() {
        const response = await fetch("sections.json");
        return await response.json();
      }

      // –ü–æ–∫–∞–∑–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Ä–∞–∑–¥–µ–ª–æ–≤
      async function showSections() {
        const sections = await loadData();
        let html = '<h1>üêç –ü—É—Ç—å –ü–∏—Ç–æ–Ω–∏—Å—Ç–∞</h1><div class="sections">';

        for (const [id, section] of Object.entries(sections)) {
          html += `
                    <div class="section ${section.locked ? "locked" : ""}" 
                         onclick="${
                           section.locked ? "" : `showLessons('${id}')`
                         }">
                        <span class="icon">${section.icon}</span>
                        <h3>${section.title}</h3>
                        <p>${section.description}</p>
                        ${
                          section.locked
                            ? '<div class="lock">üîí –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ</div>'
                            : ""
                        }
                    </div>
                `;
        }

        html += "</div>";
        app.innerHTML = html;
      }

      // –ü–æ–∫–∞–∑–∞—Ç—å —É—Ä–æ–∫–∏ —Ä–∞–∑–¥–µ–ª–∞
      async function showLessons(sectionId) {
        const sections = await loadData();
        const section = sections[sectionId];
        currentSection = sectionId;

        let html = `
                <button onclick="showSections()">‚Üê –ù–∞–∑–∞–¥</button>
                <h2>${section.title}</h2>
                <div class="lessons">
            `;

        for (const [lessonId, lesson] of Object.entries(section.lessons)) {
          html += `
                    <div class="lesson" onclick="showLesson('${lessonId}')">
                        <h3>${lesson.title}</h3>
                    </div>
                `;
        }

        html += "</div>";
        app.innerHTML = html;
      }

      // –ü–æ–∫–∞–∑–∞—Ç—å —É—Ä–æ–∫
      async function showLesson(lessonId) {
        const sections = await loadData();
        const lesson = sections[currentSection].lessons[lessonId];
        currentLesson = lessonId;

        app.innerHTML = `
                <button onclick="showLessons('${currentSection}')">‚Üê –ù–∞–∑–∞–¥</button>
                <h2>${lesson.title}</h2>
                <div class="content">${lesson.content}</div>
                <button onclick="showTask()">–ù–∞—á–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ</button>
            `;
      }

      // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
      async function showTask() {
        const sections = await loadData();
        const task = sections[currentSection].lessons[currentLesson].tasks[0];

        app.innerHTML = `
                <button onclick="showLesson('${currentLesson}')">‚Üê –ù–∞–∑–∞–¥</button>
                <h3>${task.question}</h3>
                <div class="options">
                    ${task.options
                      .map(
                        (opt, i) => `
                        <button onclick="checkAnswer(${i}, ${task.correct})">${opt}</button>
                    `
                      )
                      .join("")}
                </div>
            `;
      }

      // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç
      function checkAnswer(selected, correct) {
        if (selected === correct) {
          alert("‚úÖ –í–µ—Ä–Ω–æ!");
        } else {
          alert("‚ùå –ù–µ–≤–µ—Ä–Ω–æ! –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑.");
        }
      }

      // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
      document.addEventListener("DOMContentLoaded", showSections);
    </script>
  </body>
</html>
