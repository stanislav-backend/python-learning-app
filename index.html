<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ü—É—Ç—å –ü–∏—Ç–æ–Ω–∏—Å—Ç–∞</title>
  <link href="style.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <div id="app">
    <div class="app-header fade-in">
      <h1 class="app-title">üêç –ü—É—Ç—å –ü–∏—Ç–æ–Ω–∏—Å—Ç–∞</h1>
      <p class="app-subtitle">–°—Ç–∞–Ω—å –º–∞—Å—Ç–µ—Ä–æ–º Python!</p>
    </div>
    
    <div id="content" class="fade-in">
      <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è –∑–¥–µ—Å—å -->
    </div>
  </div>

  <script>
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
    const contentDiv = document.getElementById('content');
    let sectionsData = {};
    let currentUser = {};
    
    // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
    async function loadApp() {
      try {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É
        contentDiv.innerHTML = `
          <div class="loading-container">
            <div class="loading-spinner"></div>
            <p>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</p>
          </div>
        `;
        
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        const response = await fetch('sections.json');
        sectionsData = await response.json();
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        initUser();
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ä–∞–∑–¥–µ–ª—ã
        showMainMenu();
        
      } catch (error) {
        showError("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.");
        console.error(error);
      }
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function initUser() {
      if (localStorage.getItem('pythonistaUser')) {
        currentUser = JSON.parse(localStorage.getItem('pythonistaUser'));
      } else {
        currentUser = {
          progress: {},
          xp: 0,
          streak: 0
        };
        saveUserData();
      }
    }
    
    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function saveUserData() {
      localStorage.setItem('pythonistaUser', JSON.stringify(currentUser));
    }
    
    // –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    function showMainMenu() {
      let html = `
        <div class="sections-grid">
      `;
      
      for (const [id, section] of Object.entries(sectionsData)) {
        const progress = currentUser.progress[id] || 0;
        
        html += `
          <div class="section-card" onclick="showSection('${id}')">
            <div class="section-icon">${section.icon}</div>
            <h3 class="section-title">${section.title}</h3>
            <p class="section-description">${section.description}</p>
            
            ${progress > 0 ? `
              <div class="progress-bar">
                <div class="progress-fill" style="width: ${progress}%"></div>
              </div>
            ` : ''}
            
            ${section.locked ? `
              <div class="locked-overlay">
                üîí –î–æ—Å—Ç—É–ø –ø–æ—Å–ª–µ –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Ä–∞–∑–¥–µ–ª–æ–≤
              </div>
            ` : ''}
          </div>
        `;
      }
      
      html += `</div>`;
      
      contentDiv.innerHTML = html;
    }
    
    // –ü–æ–∫–∞–∑–∞—Ç—å —Ä–∞–∑–¥–µ–ª
    function showSection(sectionId) {
      const section = sectionsData[sectionId];
      
      if (section.locked) {
        showAlert('–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –ø–æ–∫–∞ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω. –ü—Ä–æ–π–¥–∏—Ç–µ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–∞–∑–¥–µ–ª—ã –¥–ª—è –¥–æ—Å—Ç—É–ø–∞.', 'error');
        return;
      }
      
      let html = `
        <button class="btn btn-outline" onclick="showMainMenu()">
          ‚Üê –ù–∞–∑–∞–¥ –∫ —Ä–∞–∑–¥–µ–ª–∞–º
        </button>
        
        <div class="section-header">
          <h2>${section.title}</h2>
          <p>${section.description}</p>
        </div>
        
        <div class="lessons-list">
      `;
      
      for (const [lessonId, lesson] of Object.entries(section.lessons)) {
        html += `
          <div class="lesson-card" onclick="showLesson('${sectionId}', '${lessonId}')">
            <div class="lesson-icon">üìö</div>
            <div class="lesson-info">
              <h3>${lesson.title}</h3>
              <p>${lesson.content.substring(0, 80)}...</p>
            </div>
            <div class="lesson-arrow">‚Üí</div>
          </div>
        `;
      }
      
      html += `</div>`;
      contentDiv.innerHTML = html;
    }
    
    // –ü–æ–∫–∞–∑–∞—Ç—å —É—Ä–æ–∫
    function showLesson(sectionId, lessonId) {
      const lesson = sectionsData[sectionId].lessons[lessonId];
      
      let html = `
        <button class="btn btn-outline" onclick="showSection('${sectionId}')">
          ‚Üê –ù–∞–∑–∞–¥ –∫ —Ä–∞–∑–¥–µ–ª—É
        </button>
        
        <div class="lesson-container">
          <h1 class="lesson-title">${lesson.title}</h1>
          
          ${lesson.image ? `
            <img src="images/${lesson.image}" class="lesson-image" alt="${lesson.title}">
          ` : ''}
          
          <div class="lesson-content">
            ${lesson.content}
          </div>
          
          <button class="btn" onclick="startTask('${sectionId}', '${lessonId}')">
            –ù–∞—á–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ ‚Üí
          </button>
        </div>
      `;
      
      contentDiv.innerHTML = html;
    }
    
    // –ù–∞—á–∞—Ç—å –∑–∞–¥–∞–Ω–∏–µ
    function startTask(sectionId, lessonId) {
      const task = sectionsData[sectionId].lessons[lessonId].tasks[0];
      
      let html = `
        <button class="btn btn-outline" onclick="showLesson('${sectionId}', '${lessonId}')">
          ‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —É—Ä–æ–∫—É
        </button>
        
        <div class="task-container">
          <h2>–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ</h2>
          <div class="task-question">${task.question}</div>
          
          <div class="task-options">
            ${task.options.map((option, index) => `
              <div class="task-option" onclick="checkAnswer('${sectionId}', '${lessonId}', ${index}, ${task.correct})">
                ${option}
              </div>
            `).join('')}
          </div>
        </div>
      `;
      
      contentDiv.innerHTML = html;
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç–≤–µ—Ç
    function checkAnswer(sectionId, lessonId, selected, correct) {
      const options = document.querySelectorAll('.task-option');
      
      options.forEach((opt, idx) => {
        if (idx === correct) {
          opt.classList.add('correct');
        }
        if (idx === selected && idx !== correct) {
          opt.classList.add('wrong');
        }
        opt.style.pointerEvents = 'none';
      });
      
      setTimeout(() => {
        if (selected === correct) {
          updateProgress(sectionId, lessonId);
          showAlert('‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ! –í—ã –ø–æ–ª—É—á–∞–µ—Ç–µ +10 XP!', 'success');
        } else {
          showAlert('‚ùå –ù–µ–≤–µ—Ä–Ω–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑!', 'error');
        }
      }, 500);
    }
    
    // –û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
    function updateProgress(sectionId, lessonId) {
      if (!currentUser.progress[sectionId]) {
        currentUser.progress[sectionId] = 0;
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º XP
      currentUser.xp += 10;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å —Ä–∞–∑–¥–µ–ª–∞
      const totalLessons = Object.keys(sectionsData[sectionId].lessons).length;
      const completedLessons = Object.keys(sectionsData[sectionId].lessons)
        .filter(id => currentUser.progress[`${sectionId}_${id}`]).length;
      
      currentUser.progress[sectionId] = Math.round((completedLessons / totalLessons) * 100);
      saveUserData();
    }
    
    // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    function showAlert(message, type) {
      const alertDiv = document.createElement('div');
      alertDiv.className = `alert alert-${type} fade-in`;
      alertDiv.innerHTML = message;
      
      contentDiv.prepend(alertDiv);
      
      setTimeout(() => {
        alertDiv.remove();
      }, 3000);
    }
    
    // –ü–æ–∫–∞–∑–∞—Ç—å –æ—à–∏–±–∫—É
    function showError(message) {
      contentDiv.innerHTML = `
        <div class="error-container">
          <div class="error-icon">‚ö†Ô∏è</div>
          <h3>–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞</h3>
          <p>${message}</p>
          <button class="btn" onclick="loadApp()">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
        </div>
      `;
    }
    
    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    document.addEventListener('DOMContentLoaded', loadApp);
  </script>
</body>
</html>
